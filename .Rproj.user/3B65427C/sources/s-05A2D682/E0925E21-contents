library(dplyr)
library(tibble)
require(hierfstat)

load(file = 'Rda/Fst-Nei/fst_hierfstat.rda')

basic_fst_stats <- basic.stats(fst_hierfstat[,-1:-2],digits = 3)
basic_fst_stats$pop.freq

save(basic_fst_stats,file = 'Rda/Fst-Nei/basic_fst_stats.rda')
load(file = 'Rda/Fst-Nei/basic_fst_stats.rda')

Fst_perlocus <-  basic_fst_stats$perloc
head(Fst_perlocus)
Fst_perlocus <- data.frame(Fst_perlocus[,7,drop=F])
head(Fst_perlocus)
Fst_perlocus <- rownames_to_column(Fst_perlocus)
names(Fst_perlocus)[1] <- 'locus'
head(Fst_perlocus)

chr <- substr(Fst_perlocus$locus,start = 1,stop = 2) 
Fst_perlocus$locus <- gsub('[1-7][A-D]-','',Fst_perlocus$locus)

Fst_perlocus <- add_column(Fst_perlocus,chr,.before = 'locus')
head(Fst_perlocus)

without_un_chr <- grep('UN',Fst_perlocus$chr)
Fst_perlocus <- Fst_perlocus[-without_un_chr,]

save(Fst_perlocus,file = 'Rda/Fst-Nei/Fst_perlocus.rda')

#########
load(file = 'Rda/Fst-Nei/Fst_perlocus.rda')

library(ggplot2)
require(lattice)

head(Fst_perlocus)
str(Fst_perlocus)

Fst_perlocus$locus <- as.integer(Fst_perlocus$locus)
Fst_perlocus$chr <- as.factor(Fst_perlocus$chr)
levels(Fst_perlocus$chr)
str(Fst_perlocus$chr)
####
str(Fst_perlocus)

greater_than_04 <- Fst_perlocus[Fst_perlocus$Fst>.04,]

xyplot(Fst ~ locus | chr, data = greater_than_04,
       layout = c(1, 3),
       as.table=T,
       main='Wheat Chromosome',
       grid=T,
       alpha=1/2,
       #group=chr,
       pch=18)  

